#!/bin/bash

# Check if a file name is provided
if [ "$#" -ne 1 ]; then
    echo "Usage: $0 <filename.csv>"
    exit 1
fi

# Set the column separator here (e.g., ',', ';', '\t' for tab, etc.)
COLUMN_SEPARATOR=','

# Check if the file exists
input_file=$1
if [ ! -f "$input_file" ]; then
    echo "File not found: $input_file"
    exit 1
fi

# Get the file extension
file_extension="${input_file##*.}"

# Function to convert CIDR to netmask
convert_to_netmask() {
    sed "s/\/32${COLUMN_SEPARATOR}/${COLUMN_SEPARATOR}255.255.255.255${COLUMN_SEPARATOR}/;s/\/31${COLUMN_SEPARATOR}/${COLUMN_SEPARATOR}255.255.255.254${COLUMN_SEPARATOR}/;s/\/30${COLUMN_SEPARATOR}/${COLUMN_SEPARATOR}255.255.255.252${COLUMN_SEPARATOR}/;s/\/29${COLUMN_SEPARATOR}/${COLUMN_SEPARATOR}255.255.255.248${COLUMN_SEPARATOR}/;s/\/28${COLUMN_SEPARATOR}/${COLUMN_SEPARATOR}255.255.255.240${COLUMN_SEPARATOR}/;s/\/27${COLUMN_SEPARATOR}/${COLUMN_SEPARATOR}255.255.255.224${COLUMN_SEPARATOR}/;s/\/26${COLUMN_SEPARATOR}/${COLUMN_SEPARATOR}255.255.255.192${COLUMN_SEPARATOR}/;s/\/25${COLUMN_SEPARATOR}/${COLUMN_SEPARATOR}255.255.255.128${COLUMN_SEPARATOR}/;s/\/24${COLUMN_SEPARATOR}/${COLUMN_SEPARATOR}255.255.255.0${COLUMN_SEPARATOR}/;s/\/23${COLUMN_SEPARATOR}/${COLUMN_SEPARATOR}255.255.254.0${COLUMN_SEPARATOR}/;s/\/22${COLUMN_SEPARATOR}/${COLUMN_SEPARATOR}255.255.252.0${COLUMN_SEPARATOR}/;s/\/21${COLUMN_SEPARATOR}/${COLUMN_SEPARATOR}255.255.248.0${COLUMN_SEPARATOR}/;s/\/20${COLUMN_SEPARATOR}/${COLUMN_SEPARATOR}255.255.240.0${COLUMN_SEPARATOR}/;s/\/19${COLUMN_SEPARATOR}/${COLUMN_SEPARATOR}255.255.224.0${COLUMN_SEPARATOR}/;s/\/18${COLUMN_SEPARATOR}/${COLUMN_SEPARATOR}255.255.192.0${COLUMN_SEPARATOR}/;s/\/17${COLUMN_SEPARATOR}/${COLUMN_SEPARATOR}255.255.128.0${COLUMN_SEPARATOR}/;s/\/16${COLUMN_SEPARATOR}/${COLUMN_SEPARATOR}255.255.0.0${COLUMN_SEPARATOR}/;s/\/15${COLUMN_SEPARATOR}/${COLUMN_SEPARATOR}255.254.0.0${COLUMN_SEPARATOR}/;s/\/14${COLUMN_SEPARATOR}/${COLUMN_SEPARATOR}255.252.0.0${COLUMN_SEPARATOR}/;s/\/13${COLUMN_SEPARATOR}/${COLUMN_SEPARATOR}255.248.0.0${COLUMN_SEPARATOR}/;s/\/12${COLUMN_SEPARATOR}/${COLUMN_SEPARATOR}255.240.0.0${COLUMN_SEPARATOR}/;s/\/11${COLUMN_SEPARATOR}/${COLUMN_SEPARATOR}255.224.0.0${COLUMN_SEPARATOR}/;s/\/10${COLUMN_SEPARATOR}/${COLUMN_SEPARATOR}255.192.0.0${COLUMN_SEPARATOR}/;s/\/9${COLUMN_SEPARATOR}/${COLUMN_SEPARATOR}255.128.0.0${COLUMN_SEPARATOR}/;s/\/8${COLUMN_SEPARATOR}/${COLUMN_SEPARATOR}255.0.0.0${COLUMN_SEPARATOR}/;s/\/7${COLUMN_SEPARATOR}/${COLUMN_SEPARATOR}254.0.0.0${COLUMN_SEPARATOR}/;s/\/6${COLUMN_SEPARATOR}/${COLUMN_SEPARATOR}252.0.0.0${COLUMN_SEPARATOR}/;s/\/5${COLUMN_SEPARATOR}/${COLUMN_SEPARATOR}248.0.0.0${COLUMN_SEPARATOR}/;s/\/4${COLUMN_SEPARATOR}/${COLUMN_SEPARATOR}240.0.0.0${COLUMN_SEPARATOR}/;s/\/3${COLUMN_SEPARATOR}/${COLUMN_SEPARATOR}224.0.0.0${COLUMN_SEPARATOR}/;s/\/2${COLUMN_SEPARATOR}/${COLUMN_SEPARATOR}192.0.0.0${COLUMN_SEPARATOR}/;s/\/1${COLUMN_SEPARATOR}/${COLUMN_SEPARATOR}128.0.0.0${COLUMN_SEPARATOR}/" "$1"
}

# Function to convert netmask to CIDR
convert_to_cidr() {
    sed "s/${COLUMN_SEPARATOR}32/${COLUMN_SEPARATOR}255.255.255.255/;s/${COLUMN_SEPARATOR}255.255.255.254${COLUMN_SEPARATOR}/\/31${COLUMN_SEPARATOR}/;s/${COLUMN_SEPARATOR}255.255.255.252${COLUMN_SEPARATOR}/\/30${COLUMN_SEPARATOR}/;s/${COLUMN_SEPARATOR}255.255.255.248${COLUMN_SEPARATOR}/\/29${COLUMN_SEPARATOR}/;s/${COLUMN_SEPARATOR}255.255.255.240${COLUMN_SEPARATOR}/\/28${COLUMN_SEPARATOR}/;s/${COLUMN_SEPARATOR}255.255.255.224${COLUMN_SEPARATOR}/\/27${COLUMN_SEPARATOR}/;s/${COLUMN_SEPARATOR}255.255.255.192${COLUMN_SEPARATOR}/\/26${COLUMN_SEPARATOR}/;s/${COLUMN_SEPARATOR}255.255.255.128${COLUMN_SEPARATOR}/\/25${COLUMN_SEPARATOR}/;s/${COLUMN_SEPARATOR}255.255.255.0${COLUMN_SEPARATOR}/\/24${COLUMN_SEPARATOR}/;s/${COLUMN_SEPARATOR}255.255.254.0${COLUMN_SEPARATOR}/\/23${COLUMN_SEPARATOR}/;s/${COLUMN_SEPARATOR}255.255.252.0${COLUMN_SEPARATOR}/\/22${COLUMN_SEPARATOR}/;s/${COLUMN_SEPARATOR}255.255.248.0${COLUMN_SEPARATOR}/\/21${COLUMN_SEPARATOR}/;s/${COLUMN_SEPARATOR}255.255.240.0${COLUMN_SEPARATOR}/\/20${COLUMN_SEPARATOR}/;s/${COLUMN_SEPARATOR}255.255.224.0${COLUMN_SEPARATOR}/\/19${COLUMN_SEPARATOR}/;s/${COLUMN_SEPARATOR}255.255.192.0${COLUMN_SEPARATOR}/\/18${COLUMN_SEPARATOR}/;s/${COLUMN_SEPARATOR}255.255.128.0${COLUMN_SEPARATOR}/\/17${COLUMN_SEPARATOR}/;s/${COLUMN_SEPARATOR}255.255.0.0${COLUMN_SEPARATOR}/\/16${COLUMN_SEPARATOR}/;s/${COLUMN_SEPARATOR}255.254.0.0${COLUMN_SEPARATOR}/\/15${COLUMN_SEPARATOR}/;s/${COLUMN_SEPARATOR}255.252.0.0${COLUMN_SEPARATOR}/\/14${COLUMN_SEPARATOR}/;s/${COLUMN_SEPARATOR}255.248.0.0${COLUMN_SEPARATOR}/\/13${COLUMN_SEPARATOR}/;s/${COLUMN_SEPARATOR}255.240.0.0${COLUMN_SEPARATOR}/\/12${COLUMN_SEPARATOR}/;s/${COLUMN_SEPARATOR}255.224.0.0${COLUMN_SEPARATOR}/\/11${COLUMN_SEPARATOR}/;s/${COLUMN_SEPARATOR}255.192.0.0${COLUMN_SEPARATOR}/\/10${COLUMN_SEPARATOR}/;s/${COLUMN_SEPARATOR}255.128.0.0${COLUMN_SEPARATOR}/\/9${COLUMN_SEPARATOR}/;s/${COLUMN_SEPARATOR}255.0.0.0${COLUMN_SEPARATOR}/\/8${COLUMN_SEPARATOR}/;s/${COLUMN_SEPARATOR}254.0.0.0${COLUMN_SEPARATOR}/\/7${COLUMN_SEPARATOR}/;s/${COLUMN_SEPARATOR}252.0.0.0${COLUMN_SEPARATOR}/\/6${COLUMN_SEPARATOR}/;s/${COLUMN_SEPARATOR}248.0.0.0${COLUMN_SEPARATOR}/\/5${COLUMN_SEPARATOR}/;s/${COLUMN_SEPARATOR}240.0.0.0${COLUMN_SEPARATOR}/\/4${COLUMN_SEPARATOR}/;s/${COLUMN_SEPARATOR}224.0.0.0${COLUMN_SEPARATOR}/\/3${COLUMN_SEPARATOR}/;s/${COLUMN_SEPARATOR}192.0.0.0${COLUMN_SEPARATOR}/\/2${COLUMN_SEPARATOR}/;s/${COLUMN_SEPARATOR}128.0.0.0${COLUMN_SEPARATOR}/\/1${COLUMN_SEPARATOR}/" "$1"
}

# Determine the format and convert
if grep -q "\/[0-9]\{1,2\}${COLUMN_SEPARATOR}" "$input_file"; then
    # CIDR format detected
    output_file="${input_file%.*}_netmask.${file_extension}"
    convert_to_netmask "$input_file" > "$output_file"
else
    # Assume netmask format
    output_file="${input_file%.*}_cidr.${file_extension}"
    convert_to_cidr "$input_file" > "$output_file"
fi

echo "Conversion completed. Output file: $output_file"
